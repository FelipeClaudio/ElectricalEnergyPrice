\paragraph{}Neste capítulo são mostrados os resultados obtidos através da aplicação do método descrito no capítulo anterior. Alguns resultados obtidos serão expostos no apêndice para facilitar a leitura.

\section{Pré-Processamento}
\paragraph{}Será mostrado pré-processamento realizado com o preço do PLD, sendo que o mesmo método foi replicado posteriormente para todos os dados de entrada. Será feita uma decomposição conforme a mostrada em \ref{series_temporais}. O primeiro passo é extrair a tendência do sinal. 

\subsection{Tendência}
\paragraph{}Dado o tamanho reduzido do dataset, tornou-se necessário aproveitar cada amostra. Sendo assim, um filtro como o visto em \ref{mediaMovelSimples} não era aplicável. Utilizou-se uma abordagem híbrida onde as primeiras amostras seriam obtidas através de uma regressão linear e assim que o número de amostras fosse suficiente, seria aplicada a média móvel. Como a transição entre os dois métodos de extração nem sempre era suave, havia a possibilidade de gerar altas frequência nas transformadas de Fourier usadas nas análise, por isso utilizou se uma transição mais suave. O processamento utilizado na extração da tendência pode ser visto na fórmula abaixo:

\paragraph{}Para um filtro de média de comprimento $W$ com $K$ passos de transição e com $0 \leq \alpha \leq 1 $ proporcional ao número de passos de transição, define-se o seguinte filtro para resolver o problema da falta de pontos para realizar a média móvel.
\begin{equation} \label{maLinFit}
	\hat{y} = \begin{cases}
	X_i, & \mbox{se } i \leq 2\\
	
	LR(1, X_i), & \mbox{se } 2 < i < W \\
	
	\alpha LR(1, X_W) + (1 - \alpha) MA(W), & \mbox{se } W \leq i < W + K\\
	
	MA(W), & \mbox{se } i \geq W + K

	\end{cases}
\end{equation}

\paragraph{}Onde LR ser refere à regressão linear e MA se refere à média móvel e é dada pela seguinte equação:
\begin{equation}
MA(M) = \dfrac{1}{W + 1} \sum_{j = -W}^{0} x_{t+j}  
\end{equation}

\paragraph{}A outra proposta de extração de tendência utilizada foi a seguinte:
\begin{equation} \label{maOnly}
	\hat{y} = \begin{cases}
	X_i, & \mbox{se } i \leq W\\
	
	MA(W), & \mbox{se } i > W

\end{cases}
\end{equation}

\paragraph{}As duas fórmulas acima dependem do parâmetro ($W$) o qual varia conforme o problema a ser resolvido. A escolha do $W$ foi feita a partir da análise do MSE pelo tamanho da janela. Como o objetivo é obter uma função que tenha a capacidade de prever a tendência um passo à frente com o mínimo erro possível  busca-se um valor de $W$ que não seja pequeno demais (pouca generalização) nem muito grande (pouco sensível às variações).

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{mseComparation_trend_pt.jpg}
				
				\caption[\small{Análise do mse pelo tamanho da janela na extração da tendência.}]{\label{mseTrend} \small{Análise do mse pelo tamanho da janela na extração da tendência.}}
				
			\end{center}
			
		}	
	\end{center}	
\end{figure}

\paragraph{}Tendo como base o gráfico visto acima, observou-se que a extração proposta em \ref{maLinFit} obteve os melhores resultados e o selecionou-se $W=12$. O parâmetro $K$ foi definido como $K=5$ de forma empírica, de forma a obter uma transição sauve entre a regressão linear e a média móvel. Aplicando esse filtro obteve-se o seguinte resultado para a extração da tendência:

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{fftAndDistribution_trend_pt.jpg}
				
				\caption[\small{Distribuição residual e FFT da tendência.}]{\label{fftAndDistTrend} \small{\textbf{Distribuição residual e FFT do sinal extraído}.}}
				
			\end{center}
			
		}	
	\end{center}	
\end{figure}

\subsection{Sazonalidade}
\paragraph{}Após a extração da tendência, o sinal restante é descrito pela seguinte fórmula: $s_{1t} = sz_t + cs_t + res_t$. A análise foi similar à realizada acima, porém, no caso da sazonalidade a série é decimada conforme um parâmetro T que indica o tamanho do lag temporal utilizado.

\paragraph{}As fórmulas utilizadas na extração da sazonalidade foram as seguintes:
\begin{equation} \label{linFitSz}
\hat{y} = \begin{cases}
X_{RESTO(i/T)}, & \mbox{se } i \leq 2T\\

LR(1, X^{*}), & \mbox{se } i > 2T 
\end{cases}
\end{equation}

\begin{equation} \label{maSz}
\hat{y} = \begin{cases}
X_{RESTO(i/T)}, & \mbox{se } i \leq 2T\\

MA(1, X^{*}), & \mbox{se } i > 2T 
\end{cases}
\end{equation}

\paragraph{}Onde $X^{*}$ é o conjunto composto por todas as amostras em um determinado instante onde $RESTO(i/T) = 0$.

\paragraph{} Em \ref{linFitSz} utiliza-se a regressão linear dos pontos decimados para tentar prever a sazonalidade, já em \ref{maSz} utiliza-se a média móvel. Em ambos os casos utilizam-se todos os pontos fornecidos ao filtro como base para a previsão, eliminando o problema de selecionar o parâmetro $W$. Todavia, ainda existe o problema de selecionar o valor correto do parâmetro $T$ para que se obtenha o menor erro possível na extração da componente sazonal. A análise do erro pela variação do parâmetro $T$ pode ser vista nos gráficos a seguir.

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{mseComparation_tseasonal_pt.jpg}
				
				\caption[\small{Análise do mse pelo tamanho da janela na extração da sazonalidade.}]{\label{mseSazonal} \small{Análise do mse pelo tamanho da janela na extração da sazonalidade.}}
				
			\end{center}
			
		}	
	\end{center}	
\end{figure}

\paragraph{}Nesse caso observou-se que existe um mínimo local em $T=6$ e um mínimo global em $T=12$. Escolheu se o $T=6$ por ser um múltiplo comum dos dois. Entre as duas análises, a que trouxe melhores resultados foi a que utilizou somente a média móvel. Finalmente obteve-se como resultado da extração os seguintes gráficos:

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{fftAndDistribution_seasonal_pt.jpg}
				
				\caption[\small{Distribuição residual e FFT da sazonalidade.}]{\label{fftAndDistSazonal} \small{Análise do mse pelo tamanho da janela na extração da sazonalidade.}}
				
			\end{center}	
		}	
	\end{center}	
\end{figure}

\subsection{Ciclos Senoidais e Resíduo}
\paragraph{}Após o processamento descrito acima, obtém se o sinal $s_{2t}=cs_t+res_t$, o qual tem a seguinte distribuição e FFT.

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{fftAndDistribution_residual_pt.jpg}
				
				\caption[\small{Análise do mse pelo tamanho da janela na extração da sazonalidade.}]{\label{fftAndDistCS} \small{Análise do mse pelo tamanho da janela na extração da sazonalidade.}}
				
			\end{center}
			
		}	
	\end{center}	
\end{figure}


\paragraph{}O ciclo senoidal foi obtido através da otimização do erro entre o seno e o sinal $s_{2t}$. Obtendo assim como resultado a amplitude, a frequência, a média e a fase da senoide que melhor adere ao sinal $s_{2t}$.

\paragraph{}Para a extração do resíduo de fato utilizou-se um filtro notch com frequência $w=0.10869$ rad/amostra e $Q=0.01$ removendo então a frequência com maior energia na transformada de Fourier. Obtendo a seguinte distribuição e FFT:

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{fftAndDistribution_residualFiltered_pt.jpg}
				
				\caption[\small{Distribuição e FFT após extração da componente de maior energia.}]{\label{fftAndDistFilt} \small{Distribuição e FFT após extração da componente de maior energia.}}
				
			\end{center}
			
		}	
	\end{center}	
\end{figure}

\paragraph{}Ao final do processo tem-se o seguinte resultado:
\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{resultPld_tsa_pt.jpg}
				
				\caption[\small{Resultado Final com as componentes separadas utilizando o método descrito acima.}]{\label{resultado_Extracao} \small{Resultado Final com as componentes separadas utilizando o método descrito acima.}}
				
			\end{center}
		}	
	\end{center}	
\end{figure}

\paragraph{}Para os outros sinais de entrada a abordagem para a extração do sinal residual foi similar e os gráficos obtidos podem ser vistos no apêndice.

\subsection{Seleção dos atrasos do sinal de saída}
\paragraph{}Para a seleção dos atrasados utilizados no sinal de entrada foi utilizado o gráfico de autocorrelação. Observou-se que existem atrasos relevantes para um período até 20 meses. Sendo assim selecionou-se todos os atrasos com aproximadamente 95\% de confiança ou mais.

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{autocorrelation_PLD.jpg}
				
				\caption[\small{Autocorrelação do PLD.}]{\label{autoCorrelacaoPLD} \small{Autocorrelação do PLD.}}
				
			\end{center}
		}	
	\end{center}	
\end{figure}

\paragraph{}O gráfico de autocorrelação expressa de forma numérica uma relação linear entre o valor atual e os atrasos. Com isso têm-se os atrasos com maior importância na formação do sinal. Essa informação será utilizada para definir os atrasos utilizados no sinal de entrada.

\subsection{Seleção dos sinais de entrada}
\paragraph{}Os sinais de entrada foram selecionado conforme a seguinte matriz de autocorrelação abaixo:

\begin{figure}[H]
	\begin{center}
		{
			\begin{center}
				
				\includegraphics[width=\textwidth]{corr_plot_pt.jpg}
				
				\caption[\small{Correlação dos dados de entrada.}]{\label{correlacaoDadosEntrada} \small{Correlação dos dados de entrada.}}
				
			\end{center}
		}	
	\end{center}	
\end{figure}

\paragraph{}Observou-se alta correlação negativa entre a energia produzida pela hidroelétricas e térmicas. Isso ocorre pelo fato da energia gerada pelas termoelétricas ser a principal substituta para a energia proveniente de usinas térmicas. Sendo assim, decidiu-se então remover a série da energia gerada pelas UTEs de forma a remover a redundância dos dados fornecidos.

\paragraph{}Completar seção do processamento do sinal de entrada
\section{Treinamento das redes neurais}
\paragraph{}Dado que as entradas foram selecionadas e previamente processadas, restou definir a arquitetura da rede neural utilizada. Devido à simplicidade e a boa capacidade de solução de problemas, foi utilizada a rede Perceptron Multicamadas com somente uma camada intermediária. Foi definido para a camada de entrada e a intermediária que a função de ativação utilizada seria a ReLU, dado a velocidade de processamento e os bons resultados obtidos em pesquisas recentes \ref{reluSucesso}. Para a camada de saída, a função de ativação escolhida foi a linear, para que se possa construir a série temporal. O algoritmo de aprendizado utilizado foi o adadelta com learning rate de $\alpha = 0.01$ \cite{adadelta} por conta dos bons resultados obtidos no treinamento e rápida convergência para o estado final.

\paragraph{}O treinamento foi feito utilizando validação cruzada com 8 folds no dataset de treinamento. Assim, como mencionado anteriormente, foram deixados 3 pontos da série temporal para realizar o teste.Para cada fold foram feitas 8 inicializações aleatórias utilizando o método chamado \textit{he uniform}, o qual está descrito em \cite{K_He}. 

\paragraph{}O alpha foi escolhido de forma a fazer com que o gráfico de erro no dataset de teste e no dataset de treino pelo número de neurônios convergisse para todos os folds utilizados na validação cruzada. Foi utilizado o critério de parada antecipada \textit{early stop} para que caso a rede não melhorasse o erro obtido em 25 épocas, o processamento seria então interrompido.

\paragraph{}Apesar das definições acima, ainda há necessidade de definir a quantidade de neurônios na camada intermediária. Foi feito então um treinamento variando o número de neurônios entre 1 e 90 e a partir disso gerou-se um gráfico com o RMSE pelo número de neurônios no conjunto de validação e de teste, conforme a figura abaixo:

\paragraph{}[Inserir a figura do rmse]

\paragraph{}Como forma de avaliação do modelo, foi utilizada a regressão linear sobre o gráfico dos pontos da série original (eixo $X$) pelos pontos do série prevista (eixo $Y$), assim como visto em \ref{fit_linear}. De acordo com essa métrica, o melhor modelo é o que tem o coeficiente angular ($a$) = $1.0$  e offset ($b$) = $0$.

\paragraph{}Para facilitar a seleção dos modelos, foi feito uma tabela contendo informações sobre o erro médio, desvio padrão, coeficiente angular e offset médios para o dataset de treinamento. Criou-se a métrica para medir o desvio do $a$ e do $b$ do desejado, fazendo com que o primeiro erro fosse obtido através da fórmula $\epsilon_1 = ABS(1-a)$ e o segundo fosse obtido por $\epsilon_2 = ABS(b)$, onde $ABS$ é o valor absoluto do número. Além disso, para fins de ranqueamento, criou-se uma terceira métrica descrita como $\epsilon_3 = NORM(\epsilon_1) + NORM(\epsilon_2)$, onde $NORM$ é a normalização feita dividindo todos os valores pelo máximo do vetor. O modelo a ser utilizado é então o que tiver o menor erro $\epsilon_3$.

\paragraph{}No primeiro estágio, fez-se uma rede que tinha como entrada $x(t)$ e obtém-se como saída $y(t)$, de modo a verificar se o processo utilizado no treinamento e seleção da rede estava adequado. Dado que as previsões são somente variações desse modelo básico, torna-se de extrema importância a boa adesão do modelo ao problema. 

\paragraph{}A saída utilizada no processamento foi o sinal residual do PLD, dado que a tendência, sazonalidade e ciclos sazonais são determinísticos. Para obter valor final da PLD, é necessário combinar a parte prevista pela rede com a parte determinística previamente determinada.

\subsection{Treinamento da rede para obter a saída no mês atual}
\paragraph{}Para o treinamento 

\subsection{Treinamento da rede para obter a saída um mês a frente}

\subsection{Treinamento da rede para obter a saída para vários meses a frente}
